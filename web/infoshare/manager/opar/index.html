
<!-- NAVIGATION BAR FROM MDB STARTS HERE -->

<?php 
$activePage = basename($_SERVER['PHP_SELF'], ".html");
//echo $activePage;
//$current = 'snpbrowser';
include 'header.html';

?>

<!-- NAVIGATION BAR FROM MDB ENDS HERE -->

<!--///////////////////////////////////////////////-->

<!-- -------------------- -->
<!-- Default form subscription -->
<!--<form class="text-center border border-light p-5">-->

                                <!--<form action=" " method="get">-->
                                <form name="inputLGEx" action="search.html " method="get" class="text-center border border-light p-5">
                                    <p class="h4 mb-4">Omics Portal For Addiction Research</p>

   <!-- <p>Join our mailing list. We write rarely, but only the best content.</p>

    <p>
        <a href="" target="_blank">See the last newsletter</a>
    </p>-->
                                <!-- Large input -->
<div class="md-form form-lg">
    <input type="text" name="gene" id="inputLGEx" class="form-control form-control-lg">
    <label for="inputLGEx">Search for Gene</label>
    <!-- -->
    <!-- OJO USE THIS <button class="btn btn-mdb-color btn-rounded btn-sm my-0 ml-sm-2" type="submit">Search</button>-->
    <!--<button type="submit" class="btn btn-primary">Search</button>-->
</div>

                    
            <!--<div class="input-group md-form form-sm form-2 pl-0">
              <input class="form-control my-0 py-1 grey-border" type="text" name="gene" placeholder="Search for Gene" aria-label="Search">
    		<div class="input-group-append">
        	  <span class="input-group-text grey lighten-3" id="basic-text1"><i class="fa fa-search text-grey" aria-hidden="true"></i></span>
        	</div>-->
        	
	        </div>
	        <p>Examples: <a href="http://www.opar.io/search.html?gene=PECR&choose_species=Species.Id">PECR</a>, 
	        <a href="http://www.opar.io/search.html?gene=CDH22&choose_species=Species.Id">CDH22</a>, 
	        <a href="http://www.opar.io/search.html?gene=THY1&choose_species=Species.Id">THY1</a></p>
	        <div>
               <label class="radio-inline">
               <input type="radio" name="choose_species" id="Species.Id" value="Species.Id" checked> ANY
               <input type="radio" name="choose_species" id="4" value="4" > Human
               <input type="radio" name="choose_species" id="1" value="1" > Mouse
               <input type="radio" name="choose_species" id="2" value="2" > Rat
 			   </label>
             </div>
             <!-- Loading -->
             <div id="success"></div>
                    <!-- For success/fail messages -->
                    <!--<button type="submit" class="btn btn-primary" onclick="delaySubmit(); return false; " />Submit Registration</button>-->
                   <button type="submit" class="btn btn-primary">Search</button>
                    <!--<button type="submit" class="btn btn-primary" disabled>Search</button>-->
                    <div id="content"></div>
             <!-- Loading ENDS HERE -->
                         </form>

    </div>
<!-- Default form subscription -->
<!--<hr class="my-4">-->
    <!-- Card deck -->
<div class="card-deck">

  <!-- Card -->
  <div class="card mb-4">

    <!--Card image-->
    <div class="view overlay">
      <img class="card-img-top" src="img/Gene-Protein-Data_781x521.jpg" alt="Card image cap">
      <a href="#!">
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>

    <!--Card content-->
    <div class="card-body">

      <!--Title-->
      <h4 class="card-title">Gene/Protein Data</h4>
      <!--Text-->
      <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
      <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
      <button type="button" class="btn btn-light-blue btn-md">Read more</button>

    </div>

  </div>
  <!-- Card -->

  <!-- Card -->
  <div class="card mb-4">

    <!--Card image-->
    <div class="view overlay">
      <img class="card-img-top" src="img/Human_Addiction.jpg" alt="Card image cap">
      <a href="#!">
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>

    <!--Card content-->
    <div class="card-body">

      <!--Title-->
      <h4 class="card-title">Human Addiction</h4>
      <!--Text-->
      <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
      <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
      <button type="button" class="btn btn-light-blue btn-md">Read more</button>

    </div>

  </div>
  <!-- Card -->

  <!-- Card -->
  <div class="card mb-4">

    <!--Card image-->
    <div class="view overlay">
      <img class="card-img-top" src="img/Rodent_Models.jpg" alt="Card image cap">
      <a href="#!">
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>

    <!--Card content-->
    <div class="card-body">

      <!--Title-->
      <h4 class="card-title">Rodent Models</h4>
      <!--Text-->
      <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
      <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
      <button type="button" class="btn btn-light-blue btn-md">Read more</button>

    </div>

  </div>
  <!-- Card -->

</div>
<!-- Card deck -->

<!--SECOND CARD DECK-->
<!-- Card deck -->
<div class="card-deck">

  <!-- Card -->
  <div class="card mb-4">

    <!--Card image-->
    <div class="view overlay">
      <img class="card-img-top" src="img/Advanced_Tools_p.jpg" alt="Card image cap">
      <a href="#!">
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>

    <!--Card content-->
    <div class="card-body">

      <!--Title-->
      <h4 class="card-title">Advanced Tools</h4>
      <!--Text-->
      <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
      <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
      <button type="button" class="btn btn-light-blue btn-md">Read more</button>

    </div>

  </div>
  <!-- Card -->

  <!-- Card -->
  <div class="card mb-4">

    <!--Card image-->
    <div class="view overlay">
      <img class="card-img-top" src="img/Other_Resources_2.jpg" alt="Card image cap">
      <a href="#!">
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>

    <!--Card content-->
    <div class="card-body">

      <!--Title-->
      <h4 class="card-title">Related Rodent Research Resources</h4>
      <!--Text-->
      <p class="card-text">
      <ul class="list-group">
  <li class="list-group-item text-left"><a href="https://rgd.mcw.edu/" target="_blank">RGD</a></li>
  <li class="list-group-item text-left"><a href="http://ratgenes.org" target="_blank">NIDA Center for GWAS in Outbred Rats</a></li>
  <li class="list-group-item text-left"><a href="https://www.jax.org/research-and-faculty/tools/systems-neurogenetics" target="_blank">NIDA Center for Systems Neurogenetics of Addiction</a></li>
  <li class="list-group-item text-left"><a href="http://www.rrrc.us/" target="_blank">Rat Resource & Research Center</a></li>
  <li class="list-group-item text-left"><a href="http://www.syphad.org/" target="_blank">SYPHAD</a></li>
  <li class="list-group-item text-left"><a href="http://www.chemnetdb.org/" target="_blank">ChemNetDB</a></li>
</ul></p>
      
     

      <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
      <button type="button" class="btn btn-light-blue btn-md">Read more</button>

    </div>

  </div>
  <!-- Card -->

  <!-- Card -->
  <div class="card mb-4">

    <!--Card image-->
    <div class="view overlay">
      <img class="card-img-top" src="img/News.jpg" alt="Card image cap">
      <a href="#!">
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>

    <!--Card content-->
    <div class="card-body">

      <!--Title-->
      <h4 class="card-title">Latest News</h4>
      <!--Text-->
      <div class="pre-scrollable">
      <p class="card-text"><a class="twitter-timeline" href="https://twitter.com/OPARProject">Tweets by OPAR</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
      </p>
      </div>
      <!-- Provides extra visual weight and identifies the primary action in a set of buttons -->
      <!--<button type="button" class="btn btn-light-blue btn-md">Read more</button>-->

    </div>

  </div>
  <!-- Card -->

</div>
<!-- Card deck -->


    <!--<button type="button" class="btn btn-blue waves-effect">Buy now <span class="fa fa-diamond ml-1"></span></button>
    <button type="button" class="btn btn-outline-primary waves-effect">Download <i class="fa fa-download ml-1"></i></button>-->
    

    
    <!-&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&-->
    <div class="container">

    <div class="row">

        <?php
	//require_once("../includes/leftMenu.html");

    	//Include the PS_Pagination class
	include('includes/ps_pagination.html');

	    //Connect to mysql db
    require "includes/db.inc";

?>
 <?php
					error_reporting(E_ERROR);
                    //Records found starts here

                     if(!$num = mysql_num_rows($result)):
                      endif;
                      //echo($num . " Entries found for Gene: <strong>" .$row['Symbol']. "</strong><p>");

                    //Records found ends here

                    if( isset( $_GET['gene'] ) && strlen( trim( $_GET['gene'] ) ) > 0  )
                    {
                    $Symbol = $_GET['gene'];
                    $choose_species = $_GET['choose_species'];
                    //$laopo = ${'gene='.$Symbol'&choose_species=Species.Id'};
                    $laopo = "gene=$Symbol&choose_species=$choose_species";
                    //$question = ${'question'.$var}[0];
                    //$my_variables = 'gene=shh&choose_species=Species.Id'

                    //require "../includes/db.inc"; //fine using $conn

                    //$sql = "select * from Organizations where OrganizationName like '%$OrganizationName%'";

                    $sql = "SELECT
                    Species.SpeciesName AS Species,
                    InbredSet.Name AS InbredSet,
                    Tissue.Name AS Tissue,
                    ProbeSetFreeze.Name AS ProbeSetFreeze,
                    ProbeSet.Name AS ProbeSet,
                    ProbeSet.Symbol,
                    ProbeSet.description,
                    ProbeSet.Chr,
                    ProbeSet.Mb,
                    ProbeSet.Probe_set_Blat_Mb_end AS Probe_set_Blat_Mb_end,
                    ProbeSetXRef.Mean AS Mean,
                    FORMAT(Mean,2),
                    ProbeSetXRef.LRS AS LRS,
                    FORMAT(LRS,2),
                    ProbeSetXRef.Locus,
                    ProbeSetXRef.pValue,
                    ProbeSetXRef.additive
                    FROM Species, InbredSet, ProbeSetXRef, ProbeSet, ProbeFreeze, ProbeSetFreeze, Tissue
                    WHERE InbredSet.SpeciesId=Species.Id
                    AND Species.Id=$choose_species
                    AND ProbeFreeze.InbredSetId=InbredSet.Id
                    AND ProbeFreeze.TissueId=Tissue.Id
                    AND ProbeSetFreeze.ProbeFreezeId=ProbeFreeze.Id
                    AND ( MATCH (ProbeSet.Name,ProbeSet.description,ProbeSet.symbol,alias,GenbankId, UniGeneId, Probe_Target_Description) AGAINST ('%$Symbol%' IN BOOLEAN MODE) )
                    AND ProbeSet.Id = ProbeSetXRef.ProbeSetId
                    AND ProbeSetXRef.ProbeSetFreezeId=ProbeSetFreeze.Id
                    AND ProbeSetFreeze.confidentiality < 1
                    AND ProbeSetFreeze.public > 0
                    ORDER BY Species.SpeciesName, InbredSet.Name, Tissue.Name, ProbeSetFreeze.Name, ProbeSet.Name
                    ";
                    //LIMIT 50";
                    
                    //string $mean = number_format ($mean, 2);

                    //------------PAGINATION MODULE START

                    /*
                    * Create a PS_Pagination object
                    *
                    * $conn = MySQL connection object
                    * $sql = SQl Query to paginate
                    * 10 = Number of rows per page
                    * 5 = Number of links
                    * "param1=valu1&param2=value2" = You can append your own parameters to paginations links
                    */
                    //$pager = new PS_Pagination($conn, $sql, 30, 5, "param1=valu1&param2=value2");
                    //$pager = new PS_Pagination($conn, $sql, 10, 5, "param1=valu1&param2=value2", $result);
                    //$pager = new PS_Pagination($conn, $sql, 10, 5, $result);
                    $pager = new PS_Pagination($conn, $sql, 50, 10, $laopo);

                    /*
                    * Enable debugging if you want o view query errors
                    */
                    $pager->setDebug(true);

                    /*
                    * The paginate() function returns a mysql result set
                    * or false if no rows are returned by the query
                    */
                    $rs = $pager->paginate();


                    //Display the full navigation in one go
                    echo $pager->renderFullNav();
                    echo "<p>\n";
                    echo "<div>";
                    //---echo "<div align='left'>";

                    //------------PAGINATION MODULE ENDS

                    $result = mysql_query($sql, $conn);
                    //$result = mysql_query($sql, $conn) or die(mysql_error());
                    //$rs = mysql_query($sql, $conn) or die(mysql_error());

                    $num = mysql_num_rows($result);
                    //$num = mysql_num_rows($rs);

                    if ( mysql_num_rows($result) >0)
                    //if ( mysql_num_rows($rs) >0)
                    {
                    //echo "<table class='table table-striped'>";
                    //echo "<table class='table table-condensed'>";
                    echo "<table id='dtBasicExample' class='table table-striped table-bordered table-sm' cellspacing='0' width='100%'>";
                    echo "<thead>";
                    echo "<tr>";
                    echo "<th class='th-sm'>Top Related Gene<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>ProbeSet<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>Species<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>Tissue<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>InbredSet<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>Symbol<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>Description<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>Location<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>LRS<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "<th class='th-sm'>Mean<i class='fa fa-sort float-right' aria-hidden='true'></i></th>";
                    echo "</tr>";
                    echo "</thead>";
                    //echo "<table>";
                    echo($num . " Entries found for Gene: <strong>" .$Symbol. "</strong><p>");
                    
                    //^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                    
                    $lines = file('gwas_results.txt');
// Store true when the text is found
$found = false;
foreach($lines as $line)
{
  if(strpos($line, $Symbol) !== false)
  {
    $found = true;
    echo "<div class='alert alert-success' role='alert'>";
    echo $line;
    echo "</div>";
  }
}
// If the text was not found, show a message
if(!$found)
{
  echo "No related results found from GWAS <i>all addictions</i> with search term: $Symbol";
  
}
//^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
echo "<div>";
echo "RGD: ";
echo "<a href=https://rgd.mcw.edu/rgdweb/elasticResults.html?term=$Symbol&category=Gene&species=Human&cat1=General&sp1=&postCount=1&redirect=true class='badge badge-default' target='_blank'>Human</a> ";
echo "<a href=https://rgd.mcw.edu/rgdweb/elasticResults.html?term=$Symbol&category=Gene&species=Mouse&cat1=General&sp1=&postCount=1&redirect=true class='badge badge-default' target='_blank'>Mouse</a> ";
echo "<a href=https://rgd.mcw.edu/rgdweb/elasticResults.html?term=$Symbol&category=Gene&species=Rat&cat1=General&sp1=&postCount=1&redirect=true class='badge badge-default' target='_blank'>Rat</a> ";
echo "</div>";
echo "<div>";
echo "PhenoGen: ";
echo "<a href=https://phenogen.ucdenver.edu/PhenoGen/gene.jsp?speciesCB=Rn&auto=Y&geneTxt=$Symbol&genomeVer=mm10 class='badge yellow accent-4' target='_blank'>Mouse</a> ";
echo "<a href=https://phenogen.ucdenver.edu/PhenoGen/gene.jsp?speciesCB=Rn&auto=Y&geneTxt=$Symbol&genomeVer=rn6 class='badge amber accent-3' target='_blank'>Rat</a> ";
echo "</div>";



                    //----------PAGINATION INSERT START

                    $rs = $pager->paginate();
                    if(!$rs);
                    //if(!$rs) die(mysql_error());
                    while($row = mysql_fetch_assoc($rs)) {
                    
                   

                    //----------PAGINATION INSERT ENDS

                    //echo "<tr></td><td><a href=http://172.21.216.117:4004/cosinesim/?word=". $row['Symbol'] ." class='badge badge-default' target='_blank' '>Chilibot</a> | <a href=http://www.geneweaver.org/index.php?action=search&q[]=". $row['Symbol'] ." class='badge badge-info' target='_blank' '>GeneWeaver</a></td><td><a href=http://gn2.genenetwork.org/show_trait?trait_id=". $row['ProbeSet'] ."&dataset=" . $row['ProbeSetFreeze'] ." class='badge badge-primary' target='_blank' '>" . $row['ProbeSet'] ."</a></td><td>" . $row['Species'] . "</td><td>" . $row['Tissue'] . "</td><td>" .$row['InbredSet'] ."</td><td>" .$row['Symbol'] ."</td><td>" . $row['description'] ."</td><td>Chr".$row['Chr'] .": " .$row['Mb'] ."</td><td>".$row['LRS'] ."</td><td>" .$row['Mean'] ."</td></tr>";
                    echo "<tr></td><td><a href=http://172.21.216.117:4004/cosinesim/?word=". $row['Symbol'] ." class='badge badge-default' target='_blank' '>Chilibot</a> | <a href=http://www.geneweaver.org/index.php?action=search&q[]=". $row['Symbol'] ." class='badge badge-info' target='_blank' '>GeneWeaver</a></td><td><a href=http://gn2.genenetwork.org/show_trait?trait_id=". $row['ProbeSet'] ."&dataset=" . $row['ProbeSetFreeze'] ." class='badge badge-primary' target='_blank' '>" . $row['ProbeSet'] ."</a></td><td>" . $row['Species'] . "</td><td>" . $row['Tissue'] . "</td><td>" .$row['InbredSet'] ."</td><td>" .$row['Symbol'] ."</td><td>" . $row['description'] ."</td><td>Chr".$row['Chr'] .":" .$row['Mb'] * 1000000 ."-". $row['Probe_set_Blat_Mb_end'] * 1000000 ."</td><td>".$row['FORMAT(LRS,2)'] ."</td><td>" .$row['FORMAT(Mean,2)'] ."</td></tr>";
                    
                            
                            }
                            echo "</table>";

                        //----------PAGINATION MODULE START

                        /*
                        * Or you can display the individual links for more
                        * control over HTML rendering.
                        *
                        */

                        //Display the link to first page: First
                        echo $pager->renderFirst();

                        //Display the link to previous page: <<
                        echo $pager->renderPrev();

                        /*
                        * Display page links: 1 2 3
                        * $prefix = Will be prepended to the page link (optional)
                        * $suffix = Will be appended to the page link (optional)
                        *
                        */
                        echo $pager->renderNav('<span>', '</span>');

                        //Display the link to next page: >>
                        echo $pager->renderNext();

                        //Display the link to last page: Last
                        echo $pager->renderLast();

                        //----------PAGINATION MODULE ENDS
                       // }
                        }
                        else
                        {
                        echo "Record not found";
                        }


                        mysql_close($conn);
                        }
                        
                        ?>
            </section>

        </div>
    </div>
</div>
    <!--&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&-->

</div>
<!--Jumbotron-->
<!--///////////////////////////////////////////////-->


<!-- Footer -->
<footer class="page-footer font-small unique-color">

    <!-- Footer Links -->
    <div class="container-fluid text-center text-md-left">

      <!-- Grid row -->
      <div class="row">

        <!-- Grid column -->
        <div class="col-md-6 mt-md-0 mt-3">

          <!-- Content -->
          <h5 class="text-uppercase">Footer Content</h5>
          <p>Here you can use rows and columns here to organize your footer content.</p>

        </div>
        <!-- Grid column -->

        <hr class="clearfix w-100 d-md-none pb-3">

        <!-- Grid column -->
        <div class="col-md-3 mb-md-0 mb-3">

            <!-- Links -->
            <h5 class="text-uppercase">Links</h5>

            <ul class="list-unstyled">
              <li>
                <a href="#!">Link 1</a>
              </li>
              <li>
                <a href="#!">Link 2</a>
              </li>
              <li>
                <a href="#!">Link 3</a>
              </li>
              <li>
                <a href="#!">Link 4</a>
              </li>
            </ul>

          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div class="col-md-3 mb-md-0 mb-3">

            <!-- Links -->
            <h5 class="text-uppercase">Links</h5>

            <ul class="list-unstyled">
              <li>
                <a href="#!">Link 1</a>
              </li>
              <li>
                <a href="#!">Link 2</a>
              </li>
              <li>
                <a href="#!">Link 3</a>
              </li>
              <li>
                <a href="#!">Link 4</a>
              </li>
            </ul>

          </div>
          <!-- Grid column -->

      </div>
      <!-- Grid row -->

    </div>
    <!-- Footer Links -->

    <!-- Copyright -->
  <div class="footer-copyright text-center py-3 special-color">OPAR University of Tennessee Health Science Center
  <p class="pull-right"><a href="#">Back to top  </a></p></div>
      
    
    <!-- Copyright -->

  </footer>
  <!-- Footer -->


<!-- Footer -->
<!--<footer class="page-footer font-small blue">-->

  <!-- Copyright -->
  <!--<div class="footer-copyright text-center py-3">OPAR University of Tennessee Health Science Center
  <p class="pull-right"><a href="#">Back to top</a></p>
  </div>-->
  <!-- Copyright -->

<!--</footer>-->
<!-- Footer -->

    <!-- /Start your project here-->

    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <script type="text/javascript" src="js/pagination.js"></script>
 <!--</div>-->
</body>
</html>
